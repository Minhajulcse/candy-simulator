<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mofiz Candy Simulator & Animation</title>
<style>
  body {
    background: #0f172a;
    color: white;
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  .card {
    max-width: 900px;
    margin: auto;
    background: #1e293b;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 0 20px #00000055;
  }
  h2, h3 {
    margin-top: 0;
  }
  input {
    padding: 8px;
    border-radius: 8px;
    border: none;
    width: 120px;
    margin-top: 10px;
  }
  button {
    margin-left: 10px;
    padding: 8px 14px;
    background: #38bdf8;
    color: #020617;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
    font-weight: 600;
  }
  button:disabled {
    opacity: 0.6;
    cursor: default;
  }
  table {
    width: 100%;
    margin-top: 20px;
    border-collapse: collapse;
    font-size: 14px;
  }
  th, td {
    padding: 8px;
    border-bottom: 1px solid #334155;
    text-align: center;
  }

  /* Animation area */
  .animation-wrapper {
    margin-top: 30px;
    border-top: 1px solid #334155;
    padding-top: 20px;
  }
  #animationTrack {
    position: relative;
    height: 180px;
    margin-top: 15px;
    margin-bottom: 15px;
    background: #020617;
    border-radius: 12px;
    border: 1px solid #334155;
    overflow: hidden;
  }
  #groundLine {
    position: absolute;
    left: 5%;
    right: 5%;
    bottom: 30px;
    height: 4px;
    background: #38bdf8;
  }
  .friend-marker {
    position: absolute;
    bottom: 40px;
    width: 60px;
    text-align: center;
    transform: translateX(-50%);
  }
  .friend-dot {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: #fbbf24;
    margin: 0 auto 4px;
  }
  .friend-label {
    font-size: 12px;
    color: #e5e7eb;
  }

  #mofiz {
    position: absolute;
    bottom: 45px;
    left: 5%;
    width: 90px; /* adjust for your image */
    transition: left 1s linear;
  }

  .anim-info {
    font-size: 14px;
    background: #020617;
    padding: 10px;
    border-radius: 10px;
    border: 1px solid #334155;
  }
  .anim-numbers {
    font-size: 16px;
    margin-bottom: 4px;
  }
  .highlight {
    color: #38bdf8;
    font-weight: bold;
  }
</style>
</head>
<body>

<div class="card">
  <h2>üç¨ Mofiz Candy Simulator</h2>
  <p>Enter number of friends (for the math). For the animation we‚Äôll use the same N (try N = 3 to match the story).</p>

  <input type="number" id="friends" value="3" min="1" />
  <button onclick="simulate()">Show Table</button>
  <button id="playBtn" onclick="playAnimation()">‚ñ∂ Play Animation</button>

  <div id="result"></div>

  <!-- ANIMATION SECTION -->
  <div class="animation-wrapper">
    <h3>Animated story of Mofiz visiting his friends</h3>
    <p style="font-size:14px;color:#cbd5f5;">
      Watch: candies double before each friend, he gives the same amount to each friend, and finally ends with <b>0 candies</b>.
    </p>

    <div id="animationTrack">
      <div id="groundLine"></div>

      <!-- Friend positions (we‚Äôll set labels from JS) -->
      <div class="friend-marker" id="friend1" style="left: 30%;">
        <div class="friend-dot"></div>
        <div class="friend-label">Friend 1</div>
      </div>
      <div class="friend-marker" id="friend2" style="left: 55%;">
        <div class="friend-dot"></div>
        <div class="friend-label">Friend 2</div>
      </div>
      <div class="friend-marker" id="friend3" style="left: 80%;">
        <div class="friend-dot"></div>
        <div class="friend-label">Friend 3</div>
      </div>

      <!-- Mofiz image -->
      <!-- Save your picture as 'mofiz.png' in the same folder as this HTML -->
      <img id="mofiz" src="mofiz.png" alt="Mofiz walking with candies" />
    </div>

    <div class="anim-info">
      <div class="anim-numbers">
        Candies in bag: <span id="candiesText" class="highlight">‚Äì</span>
      </div>
      <div id="detailText">
        Click <b>Play Animation</b> to see the journey.
      </div>
    </div>
  </div>
</div>

<script>
function computeSteps(n) {
  const give = Math.pow(2, n);   // candies given to each friend
  const start = give - 1;        // starting candies
  const steps = [];
  let current = start;

  for (let i = 1; i <= n; i++) {
    const beforeDouble = current;
    const afterDouble = current * 2;
    const remaining = afterDouble - give;

    steps.push({
      friend: i,
      beforeDouble,
      afterDouble,
      given: give,
      remaining
    });

    current = remaining;
  }
  return { start, give, steps };
}

/* ---------- TABLE SIMULATOR (same as before, just using computeSteps) ---------- */

function simulate() {
  const n = parseInt(document.getElementById("friends").value);
  if (isNaN(n) || n <= 0) return;

  const { start, give, steps } = computeSteps(n);

  let html = `
    <p><strong>N = ${n}</strong></p>
    <p>Minimum starting candies = <strong>${start}</strong></p>
    <p>Candies given to each friend = <strong>${give}</strong></p>
    
    <h3>Step-by-Step Calculation</h3>
    <table>
      <tr>
        <th>Friend #</th>
        <th>Before Double</th>
        <th>After Double</th>
        <th>Given</th>
        <th>Remaining</th>
      </tr>
  `;

  for (const step of steps) {
    html += `
      <tr>
        <td>${step.friend}</td>
        <td>${step.beforeDouble}</td>
        <td>${step.afterDouble}</td>
        <td>${step.given}</td>
        <td>${step.remaining}</td>
      </tr>
    `;
  }
  html += "</table>";
  document.getElementById("result").innerHTML = html;
}

/* ---------- ANIMATION ("video" style) ---------- */

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function playAnimation() {
  const btn = document.getElementById("playBtn");
  const n = parseInt(document.getElementById("friends").value);
  if (isNaN(n) || n <= 0) return;

  const { start, give, steps } = computeSteps(n);

  const mofiz = document.getElementById("mofiz");
  const candiesText = document.getElementById("candiesText");
  const detailText = document.getElementById("detailText");

  // Only first 3 friend markers visible (good for N=3 story)
  const markers = [document.getElementById("friend1"),
                   document.getElementById("friend2"),
                   document.getElementById("friend3")];

  markers.forEach((m, i) => {
    if (i < steps.length) {
      m.style.display = "block";
      m.querySelector(".friend-label").textContent = "Friend " + (i + 1);
    } else {
      m.style.display = "none";
    }
  });

  btn.disabled = true;

  // Reset position & numbers
  mofiz.style.transition = "none";
  mofiz.style.left = "5%";
  candiesText.textContent = start;
  detailText.textContent = `Start: Mofiz leaves home with ${start} candies.`;

  // Allow CSS to apply
  await sleep(100);
  mofiz.style.transition = "left 1s linear";

  // Walk and show each step
  for (let i = 0; i < steps.length; i++) {
    const step = steps[i];
    const marker = markers[i];

    await sleep(800);

    // Step 1: show candies before doubling
    candiesText.textContent = step.beforeDouble;
    detailText.textContent = `Before meeting friend ${step.friend}, he has ${step.beforeDouble} candies.`;

    await sleep(1200);

    // Step 2: candies double
    candiesText.textContent = step.afterDouble;
    detailText.textContent = `Candies double: ${step.beforeDouble} √ó 2 = ${step.afterDouble}.`;

    await sleep(1200);

    // Step 3: give candies
    candiesText.textContent = step.remaining;
    detailText.textContent =
      `He gives ${give} candies to friend ${step.friend}. Remaining candies: ${step.remaining}.`;

    // Move Mofiz to this friend‚Äôs position
    if (marker) {
      const rect = marker.getBoundingClientRect();
      const trackRect = document.getElementById("animationTrack").getBoundingClientRect();
      const percent =
        ((rect.left + rect.width / 2 - trackRect.left) / trackRect.width) * 100;
      mofiz.style.left = percent + "%";
    }

    await sleep(1500);
  }

  // After last friend
  candiesText.textContent = 0;
  detailText.textContent = `After meeting the last friend, Mofiz has 0 candies left.`;

  btn.disabled = false;
}
</script>

</body>
</html>
